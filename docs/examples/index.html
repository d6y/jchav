<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>JChav - Detailed Example</title>
    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="../jchav.css" />
</head>

<body>

<h1>Examples</h1>

<h2>Overview</h2>

<p>
A full example file called <a href="./build-example.xml">build-example.xml</a> is available for you to use as a template.

This document will show a full example of how to use JChav to track performance of your deployed site over time. 
</p>

<h2>Produce A JMeter Script</h2>
<p>
The first step is to produce a JMeter script that will exercise the site you wish to test. 
The Jakarta <a href="http://jakarta.apache.org/jmeter/">JMeter</a> web pages describe how to do this in depth.
JChav produces the top level set of images based upon the labels that you put into the JMeter configuration file. 
So where possible give your tasks meaningful names. This is especially important if you are using the http proxy tool built into JMeter to make test generation easy.
JChav will do its best to turn URLs into something meaningful, but if you take the trouble to set the name on the task the resulting pages will be better.
Make sure that the test plan you have created is running as you expect it to inside the JMeter workbench. When you are happy with this script save the script as a jmx file.
</p>
<p>
We have included a small example called <a href="./digwalk.jmx">digwalk.jmx</a> which performs a series of simple calls to the <a href="http://digg.com">Digg</a> web site.
</p>

<h2>Running our script from ant</h2>
<p>
The good folks over at Programmer Planet have produced an ant task for running JMeter called <a href="http://www.programmerplanet.org/pages/projects/jmeter-ant-task.php">Jmeter Ant Task</a>.
Dowload the ant task and configure Jmeter as the describe. Confirm your task is running correctly inside ant paying particular attention to the information regarding the log format.
i.e.<b>jmeter.save.saveservice.output_format=xml</b>
</p>
<p>
The job of this ant task is to run our tests and produce an output file containing the results. But it is important that we make sure that we produce a different output file each time we perform our tests.
By default the task appends information to one file, but we want want file per run so that we can judge if the changes we have made to the software have improved or degraded performance over time.
</p>
<p>
To do this simply create a unique build id for each build performed. If you are using a continuous integration tool such as <a href="http://www.cruisecontrol.net">CruiseControl</a> then use the build id for the build, otherwise use something like a timestamp.
eg.
</p>

<pre>
  &lt;tstamp&gt;
    &lt;format property="build.id" pattern="dMMhhmmss" locale="en"/&gt;
  &lt;/tstamp&gt;
 
  &lt;jmeter
    jmeterhome="c:\jakarta-jmeter-1.8.1"
    testplan="${basedir}/test/scripts/digwalk.jmx"
    resultlog="${basedir}/test/results/digresult{$build.id}.xml"/&gt;
</pre>


<p>
Everytime we run the jmeter target we will create a file in the <code>${basedir}/test/results/</code> directory. This is the directory that we pass to the JChav task to produce our performance graphs.
</p>

<h2>Adding JChav to the build</h2>

<p>Initially you need to ensure that the jchav task is available for your ant build. The following taskdef will import the task :
</p>

<pre>
  &lt;taskdef name="jchav" classname="com.googlecode.jchav.ant.JChavTask"&gt;
    &lt;classpath&gt;
      &lt;fileset dir="${jchav.libs.dir}/"&gt;
        &lt;include name="**/*.jar"/&gt;
      &lt;/fileset&gt;
     &lt;/classpath&gt;
  &lt;/taskdef&gt;
</pre>

<p>
Once the task is available you simply need to add the task to the build. It requires two attributes. The first is <b>srcdir</b> which is the directory that contains all the logs from the JMeter runs.i.e. the directory you chose to write the JMeter output to from the above example.
The second parameter is <b>destdir</b> which is the output directory for the images and html produced by the task.

</p>

<pre>
  &lt;jchav srcdir="${basedir}/test/results/" destdir="${basedir}/test/chavoutput/"/&gt;
</pre>

</body>

</html>
		
